<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AR Building Viewer - GPS & Direct Mode</title>
    
    <!-- A-Frame -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.0/aframe.min.js"></script>
    
    <!-- AR.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ar.js/2.2.2/aframe-ar.min.js"></script>
    
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #000;
        }
        
        #controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            z-index: 150;
            font-size: 14px;
        }
        
        .mode-btn {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .mode-btn:hover { background: #0056b3; }
        .mode-btn.active { background: #28a745; }
        
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            z-index: 100;
            font-size: 14px;
            max-width: 300px;
            line-height: 1.4;
        }
        
        #gps-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 100;
            font-size: 12px;
            max-width: 280px;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 30px;
            border-radius: 15px;
            z-index: 200;
            text-align: center;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }
        
        .status-loading { background-color: orange; }
        .status-ready { background-color: green; }
        .status-error { background-color: red; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="loading">
        <h3>Inicializace AR...</h3>
        <p id="loading-text">P콏칤prava aplikace...</p>
    </div>
    
    <div id="controls">
        <div style="margin-bottom: 10px;"><strong>Re쬴m zobrazen칤:</strong></div>
        <button class="mode-btn" id="btn-direct" onclick="switchMode('direct')">
            游님 P콏칤mo p콏ede mnou
        </button>
        <button class="mode-btn" id="btn-gps" onclick="switchMode('gps')">
            游깴 GPS koordin치ty
        </button>
        <button class="mode-btn" id="btn-coordinates" onclick="showCoordinateInput()">
            游늸 Zadat koordin치ty
        </button>
    </div>
    
    <div id="info">
        <div>
            <span class="status-indicator status-loading" id="status"></span>
            <strong id="mode-title">AR Building Viewer</strong>
        </div>
        <div id="mode-description" style="margin-top: 8px;">
            Vyberte re쬴m zobrazen칤
        </div>
        <div id="distance-info" style="margin-top: 8px; font-size: 12px; color: #aaa;">
        </div>
    </div>
    
    <div id="gps-info" class="hidden">
        <div><strong>GPS informace:</strong></div>
        <div id="current-position">Va코e pozice: ---</div>
        <div id="target-position">C칤l: ---</div>
        <div id="distance-display">Vzd치lenost: ---</div>
    </div>

    <!-- Coordinate Input Modal -->
    <div id="coordinate-modal" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); color: white; padding: 30px; border-radius: 15px; z-index: 300;">
        <h3>Zadejte GPS koordin치ty</h3>
        <div style="margin: 15px 0;">
            <label>먞솬뗢a (Latitude):</label><br>
            <input type="number" id="input-lat" step="any" placeholder="nap콏. 50.0755" style="width: 200px; padding: 5px; margin-top: 5px;">
        </div>
        <div style="margin: 15px 0;">
            <label>D칠lka (Longitude):</label><br>
            <input type="number" id="input-lng" step="any" placeholder="nap콏. 14.4378" style="width: 200px; padding: 5px; margin-top: 5px;">
        </div>
        <button onclick="applyCustomCoordinates()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-right: 10px;">Pou쮂셦</button>
        <button onclick="closeCoordinateModal()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px;">Zru코it</button>
    </div>

    <!-- AR Scene -->
    <a-scene
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;"
        renderer="antialias: true; alpha: true; precision: mediump;"
        embedded
        style="width: 100vw; height: 100vh;">
        
        <!-- Assets -->
        <a-assets>
            <a-asset-item id="buildingModel" src="building.gbl"></a-asset-item>
        </a-assets>
        
        <!-- Direct mode: Model p콏칤mo p콏ed kamerou -->
        <a-entity
            id="building-direct"
            gltf-model="#buildingModel"
            position="0 -1 -5"
            scale="0.5 0.5 0.5"
            rotation="0 0 0"
            animation-mixer="clip: *"
            visible="false">
            
            <a-text
                value="Moje Budova"
                position="0 3 0"
                align="center"
                color="white"
                scale="2 2 2"
                look-at="[camera]"
                background="color: rgba(0,0,0,0.7); width: 6; height: 1.5">
            </a-text>
        </a-entity>
        
        <!-- GPS mode: Model na GPS koordin치tech -->
        <a-entity
            id="building-gps"
            gps-entity-place="latitude: 46.8013; longitude: 9.8355"
            gltf-model="#buildingModel"
            scale="8 8 8"
            rotation="0 0 0"
            animation-mixer="clip: *"
            look-at="[gps-camera]"
            visible="false">
            
            <a-text
                value="Davos Building"
                position="0 12 0"
                align="center"
                color="white"
                scale="4 4 4"
                look-at="[gps-camera]"
                background="color: rgba(0,0,0,0.7); width: 5; height: 1.2">
            </a-text>
        </a-entity>
        
        <!-- Kamera pro direct mode -->
        <a-camera 
            id="direct-camera"
            wasd-controls="enabled: true"
            look-controls="enabled: true"
            cursor="rayOrigin: mouse"
            visible="true">
        </a-camera>
        
        <!-- GPS kamera (skryt치 defaultn캩) -->
        <a-camera 
            id="gps-camera"
            gps-camera 
            rotation-reader
            wasd-controls="enabled: false"
            look-controls="enabled: true"
            visible="false">
        </a-camera>
    </a-scene>

    <script>
        // Glob치ln칤 prom캩nn칠
        let currentMode = null;
        let currentPosition = null;
        let buildingCoordinates = {lat: 46.8013, lng: 9.8355}; // Davos, 맜칳carsko
        
        // Inicializace
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('status').className = 'status-indicator status-ready';
            }, 2000);
            
            // V칳choz칤 re쬴m - direct
            switchMode('direct');
        });
        
        // P콏ep칤n치n칤 re쬴m콢
        function switchMode(mode) {
            currentMode = mode;
            
            // Reset button states
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            
            const buildingDirect = document.getElementById('building-direct');
            const buildingGPS = document.getElementById('building-gps');
            const directCamera = document.getElementById('direct-camera');
            const gpsCamera = document.getElementById('gps-camera');
            const gpsInfo = document.getElementById('gps-info');
            
            if (mode === 'direct') {
                // Direct mode - model p콏칤mo p콏ed kamerou
                document.getElementById('btn-direct').classList.add('active');
                document.getElementById('mode-title').textContent = 'Direct AR Mode';
                document.getElementById('mode-description').textContent = 'Model se zobrazuje p콏칤mo p콏ed v치mi';
                
                buildingDirect.setAttribute('visible', true);
                buildingGPS.setAttribute('visible', false);
                directCamera.setAttribute('visible', true);
                gpsCamera.setAttribute('visible', false);
                gpsInfo.classList.add('hidden');
                
                // Animace pro direct mode
                buildingDirect.setAttribute('animation', {
                    property: 'rotation',
                    to: '0 360 0',
                    loop: true,
                    dur: 15000
                });
                
            } else if (mode === 'gps') {
                // GPS mode
                document.getElementById('btn-gps').classList.add('active');
                document.getElementById('mode-title').textContent = 'GPS AR Mode';
                document.getElementById('mode-description').textContent = 'Model se zobrazuje na GPS koordin치tech';
                
                buildingDirect.setAttribute('visible', false);
                buildingGPS.setAttribute('visible', true);
                directCamera.setAttribute('visible', false);
                gpsCamera.setAttribute('visible', true);
                gpsInfo.classList.remove('hidden');
                
                // Aktualizace GPS info
                updateGPSDisplay();
                
                // Spu코t캩n칤 GPS trackingu
                startGPSTracking();
            }
            
            console.log(`P콏epnuto na re쬴m: ${mode}`);
        }
        
        // GPS tracking
        function startGPSTracking() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(
                    updatePosition, 
                    handleGPSError, 
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 30000
                    }
                );
                
                document.getElementById('loading-text').textContent = '캛ek치n칤 na GPS sign치l...';
            } else {
                handleGPSError({message: 'Geolokace nen칤 podporov치na'});
            }
        }
        
        function updatePosition(position) {
            currentPosition = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };
            
            updateGPSDisplay();
            
            const distance = calculateDistance(
                currentPosition.lat, currentPosition.lng,
                buildingCoordinates.lat, buildingCoordinates.lng
            );
            
            document.getElementById('distance-info').textContent = 
                `Vzd치lenost: ${distance.toFixed(0)}m`;
            
            console.log(`GPS aktualizov치no: ${currentPosition.lat.toFixed(6)}, ${currentPosition.lng.toFixed(6)}`);
        }
        
        function handleGPSError(error) {
            console.error('GPS chyba:', error);
            document.getElementById('status').className = 'status-indicator status-error';
            document.getElementById('distance-info').textContent = 'GPS nedostupn치';
        }
        
        function updateGPSDisplay() {
            if (currentPosition) {
                document.getElementById('current-position').textContent = 
                    `Va코e pozice: ${currentPosition.lat.toFixed(6)}, ${currentPosition.lng.toFixed(6)}`;
            }
            
            document.getElementById('target-position').textContent = 
                `C칤l: ${buildingCoordinates.lat}, ${buildingCoordinates.lng}`;
            
            if (currentPosition) {
                const distance = calculateDistance(
                    currentPosition.lat, currentPosition.lng,
                    buildingCoordinates.lat, buildingCoordinates.lng
                );
                document.getElementById('distance-display').textContent = 
                    `Vzd치lenost: ${distance.toFixed(0)}m`;
            }
        }
        
        // Zobrazen칤 modal pro zad치n칤 koordin치t콢
        function showCoordinateInput() {
            document.getElementById('coordinate-modal').style.display = 'block';
            document.getElementById('input-lat').value = buildingCoordinates.lat;
            document.getElementById('input-lng').value = buildingCoordinates.lng;
        }
        
        function closeCoordinateModal() {
            document.getElementById('coordinate-modal').style.display = 'none';
        }
        
        function applyCustomCoordinates() {
            const lat = parseFloat(document.getElementById('input-lat').value);
            const lng = parseFloat(document.getElementById('input-lng').value);
            
            if (isNaN(lat) || isNaN(lng)) {
                alert('Zadejte platn칠 koordin치ty!');
                return;
            }
            
            buildingCoordinates = {lat, lng};
            
            // Aktualizace GPS entity
            const buildingGPS = document.getElementById('building-gps');
            buildingGPS.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lng}`);
            
            updateGPSDisplay();
            closeCoordinateModal();
            
            // P콏epnut칤 do GPS re쬴mu
            switchMode('gps');
            
            console.log(`Nov칠 koordin치ty nastaveny: ${lat}, ${lng}`);
        }
        
        // V칳po캜et vzd치lenosti
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371e3;
            const 픥1 = lat1 * Math.PI/180;
            const 픥2 = lat2 * Math.PI/180;
            const 풊픥 = (lat2-lat1) * Math.PI/180;
            const 풊풭 = (lng2-lng1) * Math.PI/180;

            const a = Math.sin(풊픥/2) * Math.sin(풊픥/2) +
                    Math.cos(픥1) * Math.cos(픥2) *
                    Math.sin(풊풭/2) * Math.sin(풊풭/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

            return R * c;
        }
        
        // Model events
        document.addEventListener('DOMContentLoaded', () => {
            const buildingDirect = document.getElementById('building-direct');
            const buildingGPS = document.getElementById('building-gps');
            
            [buildingDirect, buildingGPS].forEach(building => {
                if (building) {
                    building.addEventListener('model-loaded', () => {
                        console.log('3D model na캜ten 칰sp캩코n캩!');
                        document.getElementById('status').className = 'status-indicator status-ready';
                    });
                    
                    building.addEventListener('model-error', (e) => {
                        console.error('Chyba p콏i na캜칤t치n칤 modelu:', e);
                        document.getElementById('status').className = 'status-indicator status-error';
                        document.getElementById('mode-description').textContent = 'Chyba: Nepoda콏ilo se na캜칤st building.gbl';
                    });
                }
            });
        });
    </script>
</body>
</html>
